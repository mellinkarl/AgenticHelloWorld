<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AMIE Frontend</title>
  </head>
  <body>
    <div id="app">
      <header>
        <h1>AMIE — PDF/Image Ingestion & Analysis</h1>
        <p>
          Upload a PDF/image → invoke → <strong>poll <code>/debug_state/{request_id}</code></strong>.
          Backend: <code id="api-base"></code>
          <small id="proxy-note" style="opacity:.75;"></small>
        </p>
      </header>

      <!-- ========== Upload ========== -->
      <section id="upload-section">
        <h2>1) Upload file</h2>
        <div class="file-row">
          <input id="file-input" type="file" accept=".pdf,image/*" hidden />
          <button id="btn-choose" type="button">Choose file</button>
          <span id="file-name" class="muted">No file chosen</span>
        </div>
        <label class="inline">
          <input id="with-signed-url" type="checkbox" />
          Return signed URL (temporary)
        </label>
        <div class="row">
          <button id="btn-upload" type="button">Upload</button>
        </div>
        <div id="upload-result" class="panel json"></div>
      </section>

      <!-- ========== Invoke ========== -->
      <section id="invoke-section">
        <h2>2) Invoke</h2>
        <div class="row">
          <label for="gcs-uri">doc_gcs_uri</label>
          <input id="gcs-uri" type="text" placeholder="gs://bucket/path/file.pdf" />
        </div>
        <button id="btn-invoke" type="button">Start Graph</button>
        <div id="invoke-result" class="panel json"></div>
      </section>

      <!-- ========== Poll /debug_state ========== -->
      <section id="poll-section">
        <h2>3) Poll <code>/debug_state</code></h2>
        <div class="row">
          <label for="request-id">request_id</label>
          <input id="request-id" type="text" placeholder="auto-filled from invoke" />
        </div>
        <div class="row">
          <label for="poll-interval">interval (ms)</label>
          <input id="poll-interval" type="number" value="1500" />
        </div>
        <div class="row">
          <div>
            <button id="btn-start-poll" type="button">Start Poll</button>
            <button id="btn-stop-poll" type="button">Stop Poll</button>
          </div>
          <div class="muted">Debug state is the primary view now.</div>
        </div>

        <!-- === Dashboard cards === -->
        <div class="grid">
          <div class="card" id="card-overview">
            <div class="card-hd">
              <h3>Overview</h3>
              <span id="badge-run" class="badge">—</span>
            </div>
            <div class="kv"><span class="k">request_id:</span> <span id="ov-req">—</span></div>
            <div class="kv"><span class="k">doc_gcs_uri:</span> <span id="ov-doc">—</span></div>
            <div class="kv"><span class="k">created_at:</span> <span id="ov-created">—</span></div>
            <div class="kv"><span class="k">updated_at:</span> <span id="ov-updated">—</span></div>
            <div class="kv"><span class="k">state_str:</span> <span id="ov-state-str" class="muted">—</span></div>
            <div class="route" id="route-hint">Routing: —</div>
          </div>

          <div class="card" id="card-ia">
            <div class="card-hd">
              <h3>IA — Ingestion</h3>
              <span id="badge-ia" class="badge">—</span>
            </div>
            <div class="kv"><span class="k">is_pdf:</span> <span id="ia-is-pdf">—</span></div>
            <div class="kv"><span class="k">size:</span> <span id="ia-size">—</span></div>
            <div class="kv"><span class="k">content_type:</span> <span id="ia-ct">—</span></div>
            <div class="kv"><span class="k">doc_local_uri:</span> <span id="ia-local" class="mono">—</span></div>
          </div>

          <div class="card" id="card-idca">
            <div class="card-hd">
              <h3>IDCA — Invention Detection & Classification</h3>
              <span id="badge-idca" class="badge">—</span>
            </div>
            <div class="kv"><span class="k">status:</span> <span id="idca-status">—</span></div>
            <div class="kv"><span class="k">title:</span> <span id="idca-title" class="mono">—</span></div>
            <div class="kv"><span class="k">authors:</span> <span id="idca-authors">—</span></div>
            <div class="kv"><span class="k">summary:</span></div>
            <div id="idca-summary" class="summary"></div>
          </div>

          <div class="card" id="card-naa">
            <div class="card-hd">
              <h3>NAA — Novelty Assessment</h3>
              <span id="badge-naa" class="badge">—</span>
            </div>
            <div class="kv"><span class="k">scores:</span> <span id="naa-scores">—</span></div>
            <div class="kv"><span class="k">highlights:</span> <span id="naa-hl">—</span></div>
            <div class="kv"><span class="k">risks:</span> <span id="naa-risks">—</span></div>
          </div>

          <div class="card" id="card-aa">
            <div class="card-hd">
              <h3>AA — Aggregation</h3>
              <span id="badge-aa" class="badge">—</span>
            </div>
            <div class="kv"><span class="k">verdict:</span> <span id="aa-verdict">—</span></div>
            <div class="kv"><span class="k">mode:</span> <span id="aa-mode">—</span></div>
            <div class="kv"><span class="k">merge_policy:</span> <span id="aa-merge">—</span></div>
          </div>
        </div>

        <!-- raw JSON viewer -->
        <h3 style="margin-top:1rem">Raw <code>/debug_state</code></h3>
        <div id="state-result" class="panel json"></div>
      </section>

      <!-- ========== CPC ========== -->
      <section id="cpc-section">
        <h2>Debug CPC</h2>
        <button id="btn-cpc" type="button">GET /debug/cpc</button>
        <div id="cpc-result" class="panel json"></div>
      </section>
    </div>

    <script type="module" src="/src/main.ts"></script>
  </body>
</html>
