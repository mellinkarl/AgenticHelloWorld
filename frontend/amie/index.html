<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AMIE Frontend</title>
  </head>
  <body>
    <div id="app">
      <header>
        <h1>AMIE — PDF/Image Ingestion & Analysis</h1>
        <p>
          Upload a PDF/image → invoke → <strong>poll <code>/debug_state/{request_id}</code></strong>.
          Backend: <code id="api-base"></code>
          <small id="proxy-note" style="opacity:.75;"></small>
        </p>
      </header>

      <!-- ========== Upload ========== -->
      <section id="upload-section">
        <h2>1) Upload file</h2>
        <div class="file-row">
          <input id="file-input" type="file" accept=".pdf,image/*" hidden />
          <button id="btn-choose" type="button">Choose file</button>
          <span id="file-name" class="muted">No file chosen</span>
        </div>
        <label class="inline">
          <input id="with-signed-url" type="checkbox" />
          Return signed URL (temporary)
        </label>
        <div class="row">
          <button id="btn-upload" type="button">Upload</button>
        </div>
        <pre id="upload-result" class="panel prejson"></pre>
      </section>

      <!-- ========== Invoke ========== -->
      <section id="invoke-section">
        <h2>2) Invoke</h2>
        <div class="row">
          <label for="gcs-uri">doc_gcs_uri</label>
          <input id="gcs-uri" type="text" placeholder="gs://bucket/path/file.pdf" />
        </div>
        <button id="btn-invoke" type="button">Start Graph</button>
        <pre id="invoke-result" class="panel prejson"></pre>
      </section>

      <!-- ========== Poll /debug_state ========== -->
      <section id="poll-section">
        <h2>3) Poll <code>/debug_state</code></h2>
        <div class="row">
          <label for="request-id">request_id</label>
          <input id="request-id" type="text" placeholder="auto-filled from invoke" />
        </div>
        <div class="row">
          <label for="poll-interval">interval (ms)</label>
          <input id="poll-interval" type="number" value="1500" />
        </div>
        <div class="row">
          <div>
            <button id="btn-start-poll" type="button">Start Poll</button>
            <button id="btn-stop-poll" type="button">Stop Poll</button>
          </div>
          <div class="muted">Debug state is the primary view now.</div>
        </div>

        <!-- === Dashboard cards (only state + state_str by default) === -->
        <div class="grid">
          <!-- Overview -->
          <div class="card" id="card-overview">
            <div class="card-hd">
              <h3>Overview</h3>
              <div class="hd-actions">
                <span id="badge-run" class="badge">—</span>
                <button id="toggle-overview" class="btn-sm">Details</button>
              </div>
            </div>
            <div class="kv"><span class="k">state:</span> <span id="ov-state" class="wrap">—</span></div>
            <div class="kv"><span class="k">state_str:</span> <span id="ov-state-str" class="wrap muted">—</span></div>
            <div id="detail-overview" class="panel prejson slim hide"></div>
          </div>

          <!-- IA -->
          <div class="card" id="card-ia">
            <div class="card-hd">
              <h3>IA — Ingestion</h3>
              <div class="hd-actions">
                <span id="badge-ia" class="badge">—</span>
                <button id="toggle-ia" class="btn-sm">Details</button>
              </div>
            </div>
            <div class="kv"><span class="k">state:</span> <span id="ia-state" class="wrap">—</span></div>
            <div class="kv"><span class="k">state_str:</span> <span id="ia-state-str" class="wrap muted">—</span></div>
            <div id="detail-ia" class="panel prejson slim hide"></div>
          </div>

          <!-- IDCA -->
          <div class="card" id="card-idca">
            <div class="card-hd">
              <h3>IDCA — Invention Detection & Classification</h3>
              <div class="hd-actions">
                <span id="badge-idca" class="badge">—</span>
                <button id="toggle-idca" class="btn-sm">Details</button>
              </div>
            </div>
            <div class="kv"><span class="k">state:</span> <span id="idca-state" class="wrap">—</span></div>
            <div class="kv"><span class="k">state_str:</span> <span id="idca-state-str" class="wrap muted">—</span></div>
            <div id="detail-idca" class="panel prejson slim hide"></div>
          </div>

          <!-- NAA -->
          <div class="card" id="card-naa">
            <div class="card-hd">
              <h3>NAA — Novelty Assessment</h3>
              <div class="hd-actions">
                <span id="badge-naa" class="badge">—</span>
                <button id="toggle-naa" class="btn-sm">Details</button>
              </div>
            </div>
            <div class="kv"><span class="k">state:</span> <span id="naa-state" class="wrap">—</span></div>
            <div class="kv"><span class="k">state_str:</span> <span id="naa-state-str" class="wrap muted">—</span></div>
            <div id="detail-naa" class="panel prejson slim hide"></div>
          </div>

          <!-- AA -->
          <div class="card" id="card-aa">
            <div class="card-hd">
              <h3>AA — Aggregation</h3>
              <div class="hd-actions">
                <span id="badge-aa" class="badge">—</span>
                <button id="toggle-aa" class="btn-sm">Details</button>
              </div>
            </div>
            <div class="kv"><span class="k">state:</span> <span id="aa-state" class="wrap">—</span></div>
            <div class="kv"><span class="k">state_str:</span> <span id="aa-state-str" class="wrap muted">—</span></div>
            <div id="detail-aa" class="panel prejson slim hide"></div>
          </div>
        </div>

        <!-- raw JSON viewer -->
        <h3 style="margin-top:1rem">Raw <code>/debug_state</code></h3>
        <pre id="state-result" class="panel prejson"></pre>
      </section>

      <!-- ========== CPC ========== -->
      <section id="cpc-section">
        <h2>Debug CPC</h2>
        <button id="btn-cpc" type="button">GET /debug/cpc</button>
        <pre id="cpc-result" class="panel prejson"></pre>
      </section>
    </div>

    <script type="module" src="/src/main.ts"></script>
  </body>
</html>
