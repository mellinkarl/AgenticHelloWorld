<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AMIE Frontend</title>
  </head>
  <body>
    <div id="app">
      <header>
        <h1>AMIE — PDF/Image Ingestion & Analysis</h1>
        <p>
          Upload a PDF/image → invoke → <strong>poll <code>/debug_state/{request_id}</code></strong>.
          Backend: <code id="api-base"></code>
          <small id="proxy-note" style="opacity:.75;"></small>
        </p>
      </header>

      <!-- Upload -->
      <section id="upload-section">
        <h2>1) Upload file</h2>
        <div class="file-row">
          <input id="file-input" type="file" accept=".pdf,image/*" hidden />
          <button id="btn-choose" type="button">Choose file</button>
          <span id="file-name" class="muted">No file chosen</span>
        </div>
        <label class="inline">
          <input id="with-signed-url" type="checkbox" />
          Return signed URL (temporary)
        </label>
        <div class="row">
          <button id="btn-upload" type="button">Upload</button>
        </div>
        <pre id="upload-result" class="panel prejson"></pre>
      </section>

      <!-- Invoke -->
      <section id="invoke-section">
        <h2>2) Invoke</h2>
        <div class="row">
          <label for="gcs-uri">doc_gcs_uri</label>
          <input id="gcs-uri" type="text" placeholder="gs://bucket/path/file.pdf" />
        </div>
        <button id="btn-invoke" type="button">Start Graph</button>
        <pre id="invoke-result" class="panel prejson"></pre>
      </section>

      <!-- Poll -->
      <section id="poll-section">
        <h2>3) Poll <code>/debug_state</code></h2>
        <div class="row">
          <label for="request-id">request_id</label>
          <input id="request-id" type="text" placeholder="auto-filled from invoke" />
        </div>
        <div class="row">
          <label for="poll-interval">interval (ms)</label>
          <input id="poll-interval" type="number" value="1500" />
        </div>
        <div class="row">
          <div>
            <button id="btn-start-poll" type="button">Start Poll</button>
            <button id="btn-stop-poll" type="button">Stop Poll</button>
          </div>
          <div class="muted">Debug state is the primary view now.</div>
        </div>

        <!-- Dashboard -->
        <div id="grid" class="grid">
          <!-- Overview -->
          <div class="card" id="card-overview" data-agent="overview">
            <div class="card-hd">
              <h3>Overview</h3>
              <div class="hd-actions">
                <span id="badge-run" class="badge">—</span>
                <button id="focus-overview" class="btn-sm">Details</button>
              </div>
            </div>
            <div class="kv"><span class="k">state:</span> <span id="ov-state" class="state-val nowrap">—</span></div>
            <div class="kv"><span class="k">state_str:</span> <span id="ov-state-str" class="wrap muted">—</span></div>

            <!-- focus details layout -->
            <div class="details-row hide" id="details-overview">
              <div class="detail-block">
                <h4>Artifacts</h4>
                <pre id="overview-artifacts" class="panel prejson"></pre>
              </div>
              <div class="detail-block">
                <h4>Internals</h4>
                <pre id="overview-internals" class="panel prejson"></pre>
              </div>
              <div class="detail-actions">
                <button id="exit-focus" class="btn-sm danger">Exit Focus</button>
              </div>
            </div>
          </div>

          <!-- IA -->
          <div class="card" id="card-ia" data-agent="ia">
            <div class="card-hd">
              <h3>IA — Ingestion</h3>
              <div class="hd-actions">
                <span id="badge-ia" class="badge">—</span>
                <button id="focus-ia" class="btn-sm">Details</button>
              </div>
            </div>
            <div class="kv"><span class="k">state:</span> <span id="ia-state" class="state-val nowrap">—</span></div>
            <div class="kv"><span class="k">status_str:</span> <span id="ia-state-str" class="wrap muted">—</span></div>

            <div class="details-row hide" id="details-ia">
              <div class="detail-block">
                <h4>Artifacts (IA)</h4>
                <pre id="ia-artifacts" class="panel prejson"></pre>
              </div>
              <div class="detail-block">
                <h4>Internals (IA)</h4>
                <pre id="ia-internals" class="panel prejson"></pre>
              </div>
              <div class="detail-actions">
                <button class="btn-sm danger exit-focus">Exit Focus</button>
              </div>
            </div>
          </div>

          <!-- IDCA -->
          <div class="card" id="card-idca" data-agent="idca">
            <div class="card-hd">
              <h3>IDCA — Invention Detection & Classification</h3>
              <div class="hd-actions">
                <span id="badge-idca" class="badge">—</span>
                <button id="focus-idca" class="btn-sm">Details</button>
              </div>
            </div>
            <div class="kv"><span class="k">state:</span> <span id="idca-state" class="state-val nowrap">—</span></div>
            <div class="kv"><span class="k">status_str:</span> <span id="idca-state-str" class="wrap muted">—</span></div>

            <div class="details-row hide" id="details-idca">
              <div class="detail-block">
                <h4>Artifacts (IDCA)</h4>
                <pre id="idca-artifacts" class="panel prejson"></pre>
              </div>
              <div class="detail-block">
                <h4>Internals (IDCA)</h4>
                <pre id="idca-internals" class="panel prejson"></pre>
              </div>
              <div class="detail-actions">
                <button class="btn-sm danger exit-focus">Exit Focus</button>
              </div>
            </div>
          </div>

          <!-- NAA -->
          <div class="card" id="card-naa" data-agent="naa">
            <div class="card-hd">
              <h3>NAA — Novelty Assessment</h3>
              <div class="hd-actions">
                <span id="badge-naa" class="badge">—</span>
                <button id="focus-naa" class="btn-sm">Details</button>
              </div>
            </div>
            <div class="kv"><span class="k">state:</span> <span id="naa-state" class="state-val nowrap">—</span></div>
            <div class="kv"><span class="k">status_str:</span> <span id="naa-state-str" class="wrap muted">—</span></div>

            <div class="details-row hide" id="details-naa">
              <div class="detail-block">
                <h4>Artifacts (NAA)</h4>
                <pre id="naa-artifacts" class="panel prejson"></pre>
              </div>
              <div class="detail-block">
                <h4>Internals (NAA)</h4>
                <pre id="naa-internals" class="panel prejson"></pre>
              </div>
              <div class="detail-actions">
                <button class="btn-sm danger exit-focus">Exit Focus</button>
              </div>
            </div>
          </div>

          <!-- AA -->
          <div class="card" id="card-aa" data-agent="aa">
            <div class="card-hd">
              <h3>AA — Aggregation</h3>
              <div class="hd-actions">
                <span id="badge-aa" class="badge">—</span>
                <button id="focus-aa" class="btn-sm">Details</button>
              </div>
            </div>
            <div class="kv"><span class="k">state:</span> <span id="aa-state" class="state-val nowrap">—</span></div>
            <div class="kv"><span class="k">status_str:</span> <span id="aa-state-str" class="wrap muted">—</span></div>

            <div class="details-row hide" id="details-aa">
              <div class="detail-block">
                <h4>Artifacts (Report)</h4>
                <pre id="aa-artifacts" class="panel prejson"></pre>
              </div>
              <div class="detail-block">
                <h4>Internals (AA)</h4>
                <pre id="aa-internals" class="panel prejson"></pre>
              </div>
              <div class="detail-actions">
                <button class="btn-sm danger exit-focus">Exit Focus</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Final Report -->
        <div id="final-card" class="card final hide">
          <div class="card-hd">
            <h3>Final Report</h3>
            <div class="hd-actions">
              <span id="badge-final" class="badge">—</span>
              <button id="toggle-final" class="btn-sm">Details</button>
            </div>
          </div>
          <div class="kv"><span class="k">verdict:</span> <span id="fr-verdict" class="wrap">—</span></div>
          <div class="kv"><span class="k">idca.status:</span> <span id="fr-idca-status" class="wrap">—</span></div>
          <div class="kv"><span class="k">idca.summary:</span> <span id="fr-idca-summary" class="wrap">—</span></div>
          <div class="kv"><span class="k">naa.scores:</span> <span id="fr-naa-scores" class="wrap">—</span></div>
          <div class="kv"><span class="k">doc_gcs_uri:</span> <span id="fr-doc" class="wrap mono">—</span></div>
          <div id="detail-final" class="panel prejson slim hide"></div>
        </div>

        <!-- Raw -->
        <h3 style="margin-top:1rem">Raw <code>/debug_state</code></h3>
        <pre id="state-result" class="panel prejson"></pre>
      </section>

      <!-- CPC -->
      <section id="cpc-section">
        <h2>Debug CPC</h2>
        <button id="btn-cpc" type="button">GET /debug/cpc</button>
        <pre id="cpc-result" class="panel prejson"></pre>
      </section>
    </div>

    <script type="module" src="/src/main.ts"></script>
  </body>
</html>
